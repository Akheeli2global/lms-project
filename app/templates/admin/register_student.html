{% extends "base.html" %}

{% block title %}Register New Student{% endblock %}

{% block extra_css %}
<style>
    .registration-container {
        max-width: 1000px;
        margin: 0 auto;
    }
    
    .form-section {
        background: var(--bg-white);
        border-radius: var(--border-radius-lg);
        padding: 2rem;
        margin-bottom: 2rem;
        box-shadow: var(--shadow);
    }
    
    .section-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: var(--text-primary);
        margin-bottom: 1.5rem;
        padding-bottom: 0.75rem;
        border-bottom: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        gap: 0.75rem;
    }
    
    .form-row {
        display: grid;
        grid-template-columns: 1fr 1fr;
        gap: 1.5rem;
        margin-bottom: 1.5rem;
    }
    
    .form-row.triple {
        grid-template-columns: 1fr 1fr 1fr;
    }
    
    .form-row.single {
        grid-template-columns: 1fr;
    }
    
    .form-group label {
        display: block;
        font-weight: 500;
        color: var(--text-primary);
        margin-bottom: 0.5rem;
    }
    
    .form-control {
        width: 100%;
        padding: 0.75rem 1rem;
        border: 2px solid var(--border-color);
        border-radius: var(--border-radius);
        font-size: 0.875rem;
        transition: var(--transition);
        background: var(--bg-white);
    }
    
    .form-control.is-invalid {
        border-color: var(--danger-color);
        box-shadow: 0 0 0 3px rgba(220, 53, 69, 0.1);
    }
    
    .invalid-feedback {
        color: var(--danger-color);
        font-size: 0.75rem;
        margin-top: 0.25rem;
    }
    
    .form-control:focus {
        outline: none;
        border-color: var(--primary-color);
        box-shadow: 0 0 0 3px rgba(241, 161, 80, 0.1);
    }
    
    .form-select {
        background-image: url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='none' viewBox='0 0 20 20'%3e%3cpath stroke='%236b7280' stroke-linecap='round' stroke-linejoin='round' stroke-width='1.5' d='m6 8 4 4 4-4'/%3e%3c/svg%3e");
        background-position: right 0.5rem center;
        background-repeat: no-repeat;
        background-size: 1.5em 1.5em;
        padding-right: 2.5rem;
    }
    
    .required {
        color: var(--danger-color);
    }
    
    .help-text {
        font-size: 0.75rem;
        color: var(--text-muted);
        margin-top: 0.25rem;
    }
    
    .file-upload-area {
        border: 2px dashed var(--border-color);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        text-align: center;
        transition: var(--transition);
        background: var(--bg-light);
    }
    
    .file-upload-area:hover {
        border-color: var(--primary-color);
        background: rgba(241, 161, 80, 0.05);
    }
    
    .file-upload-icon {
        font-size: 2rem;
        color: var(--text-muted);
        margin-bottom: 0.5rem;
    }
    
    .form-actions {
        display: flex;
        justify-content: space-between;
        align-items: center;
        gap: 1rem;
        padding-top: 2rem;
        border-top: 1px solid var(--border-color);
        margin-top: 2rem;
    }
    
    .btn-group {
        display: flex;
        gap: 1rem;
    }
    
    .progress-indicator {
        display: flex;
        justify-content: center;
        align-items: center;
        margin-bottom: 2rem;
        gap: 1rem;
    }
    
    .progress-step {
        display: flex;
        flex-direction: column;
        align-items: center;
        gap: 0.5rem;
        opacity: 0.5;
        transition: var(--transition);
    }
    
    .progress-step.active {
        opacity: 1;
    }
    
    .progress-step.completed {
        opacity: 1;
        color: var(--success-color);
    }
    
    .step-circle {
        width: 40px;
        height: 40px;
        border-radius: 50%;
        border: 2px solid var(--border-color);
        display: flex;
        align-items: center;
        justify-content: center;
        font-weight: 600;
        background: var(--bg-white);
    }
    
    .step-circle.active {
        border-color: var(--primary-color);
        background: var(--primary-color);
        color: white;
    }
    
    .step-circle.completed {
        border-color: var(--success-color);
        background: var(--success-color);
        color: white;
    }
    
    @media (max-width: 768px) {
        .form-row, .form-row.triple {
            grid-template-columns: 1fr;
        }
        
        .form-actions {
            flex-direction: column;
            align-items: stretch;
        }
        
        .btn-group {
            justify-content: center;
        }
        
        .progress-indicator {
            flex-wrap: wrap;
        }
    }
</style>
{% endblock %}

{% block content %}
<div class="main-content">
    <!-- Page Header -->
    <div class="page-header">
        <div class="page-header-content">
            <div class="page-title">
                <h1><i class="fas fa-user-plus"></i> Register New Student</h1>
                <p>Complete student registration with all required information</p>
            </div>
            <div class="page-actions">
                <a href="{{ url_for('admin.students') }}" class="btn btn-outline">
                    <i class="fas fa-arrow-left"></i> Back to Students
                </a>
            </div>
        </div>
    </div>

    <div class="registration-container">
        <!-- Progress Indicator -->
        <div class="progress-indicator">
            <div class="progress-step active" data-step="1">
                <div class="step-circle active">1</div>
                <span>Student Info</span>
            </div>
            <div class="progress-step" data-step="2">
                <div class="step-circle">2</div>
                <span>Academic & Fees</span>
            </div>
            <div class="progress-step" data-step="3">
                <div class="step-circle">3</div>
                <span>Parents</span>
            </div>
            <div class="progress-step" data-step="4">
                <div class="step-circle">4</div>
                <span>Profile & Docs</span>
            </div>
        </div>

        <form method="POST" enctype="multipart/form-data" id="studentRegistrationForm">
            {{ form.hidden_tag() }}
            
            <!-- Step 1: Student Information -->
            <div class="form-step active" data-step="1">
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-user"></i>
                        Student Information
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.full_name.label(class="form-label") }} <span class="required">*</span>
                            {{ form.full_name(class="form-control") }}
                            {% if form.full_name.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.full_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.email.label(class="form-label") }} <span class="required">*</span>
                            {{ form.email(class="form-control") }}
                            {% if form.email.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.email.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.phone.label(class="form-label") }}
                            {{ form.phone(class="form-control") }}
                            {% if form.phone.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.phone.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.date_of_birth.label(class="form-label") }} <span class="required">*</span>
                            {{ form.date_of_birth(class="form-control") }}
                            {% if form.date_of_birth.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.date_of_birth.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row single">
                        <div class="form-group">
                            {{ form.address.label(class="form-label") }} <span class="required">*</span>
                            {{ form.address(class="form-control", rows="3") }}
                            {% if form.address.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.address.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.state.label(class="form-label") }} <span class="required">*</span>
                            {{ form.state(class="form-control") }}
                            {% if form.state.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.state.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.pin_code.label(class="form-label") }} <span class="required">*</span>
                            {{ form.pin_code(class="form-control") }}
                            {% if form.pin_code.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.pin_code.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 2: Academic Information & Fee Structure -->
            <div class="form-step" data-step="2">
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-graduation-cap"></i>
                        Academic Information
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.grade.label(class="form-label") }} <span class="required">*</span>
                            {{ form.grade(class="form-control") }}
                            {% if form.grade.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.grade.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">e.g., 5, 10, 12, PG</div>
                        </div>
                        
                        <div class="form-group">
                            {{ form.board.label(class="form-label") }} <span class="required">*</span>
                            {{ form.board(class="form-control") }}
                            {% if form.board.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.board.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">e.g., CBSE, ICSE, State Board</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.school_name.label(class="form-label") }} <span class="required">*</span>
                            {{ form.school_name(class="form-control") }}
                            {% if form.school_name.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.school_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.academic_year.label(class="form-label") }} <span class="required">*</span>
                            {{ form.academic_year(class="form-control") }}
                            {% if form.academic_year.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.academic_year.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">e.g., 2024-25</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.course_start_date.label(class="form-label") }} <span class="required">*</span>
                            {{ form.course_start_date(class="form-control") }}
                            {% if form.course_start_date.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.course_start_date.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.department_id.label(class="form-label") }} <span class="required">*</span>
                            {{ form.department_id(class="form-control form-select") }}
                            {% if form.department_id.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.department_id.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.subjects_enrolled.label(class="form-label") }} <span class="required">*</span>
                            {{ form.subjects_enrolled(class="form-control") }}
                            {% if form.subjects_enrolled.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.subjects_enrolled.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Comma-separated list of subjects</div>
                        </div>
                        
                        <div class="form-group">
                            {{ form.relationship_manager.label(class="form-label") }}
                            {{ form.relationship_manager(class="form-control") }}
                            {% if form.relationship_manager.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.relationship_manager.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Assigned sales person or relationship manager</div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-rupee-sign"></i>
                        Fee Structure
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.total_fee.label(class="form-label") }} <span class="required">*</span>
                            {{ form.total_fee(class="form-control") }}
                            {% if form.total_fee.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.total_fee.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.amount_paid.label(class="form-label") }}
                            {{ form.amount_paid(class="form-control") }}
                            {% if form.amount_paid.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.amount_paid.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Leave empty if no payment made yet</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.payment_mode.label(class="form-label") }} <span class="required">*</span>
                            {{ form.payment_mode(class="form-control form-select") }}
                            {% if form.payment_mode.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.payment_mode.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.payment_schedule.label(class="form-label") }} <span class="required">*</span>
                            {{ form.payment_schedule(class="form-control form-select") }}
                            {% if form.payment_schedule.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.payment_schedule.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Step 3: Parent/Guardian Information -->
            <div class="form-step" data-step="3">
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-users"></i>
                        Father's Information
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.father_name.label(class="form-label") }} <span class="required">*</span>
                            {{ form.father_name(class="form-control") }}
                            {% if form.father_name.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.father_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.father_phone.label(class="form-label") }} <span class="required">*</span>
                            {{ form.father_phone(class="form-control") }}
                            {% if form.father_phone.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.father_phone.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.father_email.label(class="form-label") }}
                            {{ form.father_email(class="form-control") }}
                            {% if form.father_email.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.father_email.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.father_profession.label(class="form-label") }}
                            {{ form.father_profession(class="form-control") }}
                            {% if form.father_profession.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.father_profession.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row single">
                        <div class="form-group">
                            {{ form.father_workplace.label(class="form-label") }}
                            {{ form.father_workplace(class="form-control") }}
                            {% if form.father_workplace.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.father_workplace.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-female"></i>
                        Mother's Information
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.mother_name.label(class="form-label") }} <span class="required">*</span>
                            {{ form.mother_name(class="form-control") }}
                            {% if form.mother_name.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.mother_name.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.mother_phone.label(class="form-label") }}
                            {{ form.mother_phone(class="form-control") }}
                            {% if form.mother_phone.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.mother_phone.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.mother_email.label(class="form-label") }}
                            {{ form.mother_email(class="form-control") }}
                            {% if form.mother_email.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.mother_email.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.mother_profession.label(class="form-label") }}
                            {{ form.mother_profession(class="form-control") }}
                            {% if form.mother_profession.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.mother_profession.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row single">
                        <div class="form-group">
                            {{ form.mother_workplace.label(class="form-label") }}
                            {{ form.mother_workplace(class="form-control") }}
                            {% if form.mother_workplace.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.mother_workplace.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>
                </div>
            </div>

            <!-- Step 4: Academic Profile & Documents -->
            <div class="form-step" data-step="4">
                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-user-circle"></i>
                        Academic Profile
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.siblings.label(class="form-label") }}
                            {{ form.siblings(class="form-control") }}
                            {% if form.siblings.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.siblings.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.favorite_subjects.label(class="form-label") }}
                            {{ form.favorite_subjects(class="form-control") }}
                            {% if form.favorite_subjects.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.favorite_subjects.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Comma-separated list</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.difficult_subjects.label(class="form-label") }}
                            {{ form.difficult_subjects(class="form-control") }}
                            {% if form.difficult_subjects.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.difficult_subjects.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Areas needing extra attention</div>
                        </div>
                        
                        <div class="form-group">
                            {{ form.hobbies.label(class="form-label") }}
                            {{ form.hobbies(class="form-control") }}
                            {% if form.hobbies.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.hobbies.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Comma-separated list</div>
                        </div>
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.learning_styles.label(class="form-label") }}
                            {{ form.learning_styles(class="form-control") }}
                            {% if form.learning_styles.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.learning_styles.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Visual, Auditory, Kinesthetic, etc.</div>
                        </div>
                        
                        <div class="form-group">
                            {{ form.learning_patterns.label(class="form-label") }}
                            {{ form.learning_patterns(class="form-control") }}
                            {% if form.learning_patterns.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.learning_patterns.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Fast learner, Needs repetition, etc.</div>
                        </div>
                    </div>
                    
                    <div class="form-row single">
                        <div class="form-group">
                            {{ form.parent_feedback.label(class="form-label") }}
                            {{ form.parent_feedback(class="form-control", rows="3") }}
                            {% if form.parent_feedback.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.parent_feedback.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                            <div class="help-text">Previous tutoring experience, learning challenges, etc.</div>
                        </div>
                    </div>
                </div>

                <div class="form-section">
                    <div class="section-title">
                        <i class="fas fa-file-alt"></i>
                        Document Uploads
                    </div>
                    
                    <div class="form-row">
                        <div class="form-group">
                            {{ form.marksheet.label(class="form-label") }}
                            <div class="file-upload-area">
                                <div class="file-upload-icon">
                                    <i class="fas fa-file-alt"></i>
                                </div>
                                {{ form.marksheet(class="form-control") }}
                                <p>Upload Previous Year's Mark Sheet</p>
                            </div>
                            {% if form.marksheet.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.marksheet.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                        
                        <div class="form-group">
                            {{ form.student_aadhaar.label(class="form-label") }}
                            <div class="file-upload-area">
                                <div class="file-upload-icon">
                                    <i class="fas fa-id-card"></i>
                                </div>
                                {{ form.student_aadhaar(class="form-control") }}
                                <p>Upload Student Aadhaar Card</p>
                            </div>
                            {% if form.student_aadhaar.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.student_aadhaar.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                    
                    <div class="form-row single">
                        <div class="form-group">
                            {{ form.school_id.label(class="form-label") }}
                            <div class="file-upload-area">
                                <div class="file-upload-icon">
                                    <i class="fas fa-school"></i>
                                </div>
                                {{ form.school_id(class="form-control") }}
                                <p>Upload School ID (if available)</p>
                            </div>
                            {% if form.school_id.errors %}
                                <div class="invalid-feedback d-block">
                                    {% for error in form.school_id.errors %}
                                        {{ error }}
                                    {% endfor %}
                                </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
            </div>

            <!-- Form Actions -->
            <div class="form-actions">
                <div class="text-muted">
                    <i class="fas fa-info-circle"></i>
                    All fields marked with <span class="required">*</span> are required
                </div>
                
                <div class="btn-group">
                    <button type="button" class="btn btn-outline" id="prevBtn" style="display: none;">
                        <i class="fas fa-arrow-left"></i> Previous
                    </button>
                    <button type="button" class="btn btn-primary" id="nextBtn">
                        Next <i class="fas fa-arrow-right"></i>
                    </button>
                    {{ form.submit(class="btn btn-primary", id="submitBtn", style="display: none;") }}
                </div>
            </div>
        </form>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script>
document.addEventListener('DOMContentLoaded', function() {
    let currentStep = 1;
    const totalSteps = 4;
    
    // Elements
    const form = document.getElementById('studentRegistrationForm');
    const nextBtn = document.getElementById('nextBtn');
    const prevBtn = document.getElementById('prevBtn');
    const submitBtn = document.getElementById('submitBtn');
    
    // Step management
    function showStep(step) {
        // Hide all steps
        document.querySelectorAll('.form-step').forEach(s => s.classList.remove('active'));
        document.querySelectorAll('.progress-step').forEach(s => {
            s.classList.remove('active');
            s.querySelector('.step-circle').classList.remove('active');
        });
        
        // Show current step
        document.querySelector(`[data-step="${step}"]`).classList.add('active');
        const progressStep = document.querySelector(`.progress-step[data-step="${step}"]`);
        progressStep.classList.add('active');
        progressStep.querySelector('.step-circle').classList.add('active');
        
        // Mark completed steps
        for (let i = 1; i < step; i++) {
            const completedStep = document.querySelector(`.progress-step[data-step="${i}"]`);
            completedStep.classList.add('completed');
            completedStep.querySelector('.step-circle').classList.add('completed');
        }
        
        // Update navigation buttons
        prevBtn.style.display = step === 1 ? 'none' : 'inline-flex';
        nextBtn.style.display = step === totalSteps ? 'none' : 'inline-flex';
        submitBtn.style.display = step === totalSteps ? 'inline-flex' : 'none';
    }
    
    // Step validation - check actual required fields only
    function validateStep(step) {
        const stepElement = document.querySelector(`[data-step="${step}"]`);
        const requiredInputs = stepElement.querySelectorAll('input[required], select[required], textarea[required]');
        const requiredFields = stepElement.querySelectorAll('.required-field');
        let isValid = true;
        
        // Check inputs marked as required
        requiredInputs.forEach(field => {
            if (!field.value.trim()) {
                isValid = false;
                field.classList.add('is-invalid');
            } else {
                field.classList.remove('is-invalid');
            }
        });
        
        // Check custom required fields (marked with required asterisk)
        stepElement.querySelectorAll('.required').forEach(asterisk => {
            const formGroup = asterisk.closest('.form-group');
            if (formGroup) {
                const input = formGroup.querySelector('input, select, textarea');
                if (input && !input.value.trim()) {
                    isValid = false;
                    input.classList.add('is-invalid');
                } else if (input) {
                    input.classList.remove('is-invalid');
                }
            }
        });
        
        return isValid;
    }
    
    // File upload handling
    function setupFileUploads() {
        const fileInputs = document.querySelectorAll('input[type="file"]');
        
        fileInputs.forEach(input => {
            const uploadArea = input.closest('.file-upload-area');
            
            // Drag and drop
            uploadArea.addEventListener('dragover', function(e) {
                e.preventDefault();
                uploadArea.classList.add('dragover');
            });
            
            uploadArea.addEventListener('dragleave', function(e) {
                uploadArea.classList.remove('dragover');
            });
            
            uploadArea.addEventListener('drop', function(e) {
                e.preventDefault();
                uploadArea.classList.remove('dragover');
                
                const files = e.dataTransfer.files;
                if (files.length > 0) {
                    input.files = files;
                    updateFileDisplay(input, files[0]);
                }
            });
            
            // File selection
            input.addEventListener('change', function(e) {
                if (e.target.files.length > 0) {
                    updateFileDisplay(input, e.target.files[0]);
                }
            });
        });
    }
    
    function updateFileDisplay(input, file) {
        const uploadArea = input.closest('.file-upload-area');
        const icon = uploadArea.querySelector('.file-upload-icon i');
        const text = uploadArea.querySelector('p');
        
        icon.className = 'fas fa-check-circle';
        icon.style.color = 'var(--success-color)';
        text.textContent = `Selected: ${file.name}`;
    }
    
    // Event listeners
    nextBtn.addEventListener('click', function() {
        if (validateStep(currentStep)) {
            currentStep++;
            showStep(currentStep);
        } else {
            alert('Please fill in all required fields before proceeding.');
        }
    });
    
    prevBtn.addEventListener('click', function() {
        currentStep--;
        showStep(currentStep);
    });
    
    // Form submission
    form.addEventListener('submit', function(e) {
        // Final validation
        for (let step = 1; step <= totalSteps; step++) {
            if (!validateStep(step)) {
                e.preventDefault();
                currentStep = step;
                showStep(currentStep);
                alert(`Please complete all required fields in step ${step}.`);
                return;
            }
        }
        
        submitBtn.disabled = true;
        submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> Registering...';
    });
    
    // Initialize
    showStep(1);
    setupFileUploads();
});
</script>
{% endblock %}